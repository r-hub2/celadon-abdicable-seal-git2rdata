<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Thierry Onkelinx" />


<title>Getting Started Storing Dataframes as Plain Text</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting Started Storing Dataframes as Plain
Text</h1>
<h4 class="author">Thierry Onkelinx</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette motivates why we wrote <code>git2rdata</code> and
illustrates how you can use it to store dataframes as plain text
files.</p>
<div id="maintaining-variable-classes" class="section level3">
<h3>Maintaining Variable Classes</h3>
<p>R has different options to store dataframes as plain text files from
R. Base R has <code>write.table()</code> and its companions like
<code>write.csv()</code>. Some other options are
<code>data.table::fwrite()</code>, <code>readr::write_delim()</code>,
<code>readr::write_csv()</code> and <code>readr::write_tsv()</code>.
Each of them writes a dataframe as a plain text file by converting all
variables into characters. After reading the file, they revert this
conversion. The distinction between <code>character</code> and
<code>factor</code> gets lost in translation. <code>read.table()</code>
converts by default all strings to factors,
<code>readr::read_csv()</code> keeps by default all strings as
character. These functions cannot recover the factor levels. These
functions determine factor levels based on the observed levels in the
plain text file. Hence factor levels without observations will
disappear. The order of the factor levels is also determined by the
available levels in the plain text file, which can be different from the
original order.</p>
<p>The <code>write_vc()</code> and <code>read_vc()</code> functions from
<code>git2rdata</code> keep track of the class of each variable and, in
case of a factor, also of the factor levels and their order. Hence this
function pair preserves the information content of the dataframe. The
<code>vc</code> suffix stands for <strong>v</strong>ersion
<strong>c</strong>ontrol<!-- spell-check: ignore --> as these functions
use their full capacity in combination with a version control
system.</p>
</div>
</div>
<div id="efficiency-relative-to-storage-and-time" class="section level2">
<h2>Efficiency Relative to Storage and Time</h2>
<div id="optimizing-file-storage" class="section level3">
<h3>Optimizing File Storage</h3>
<p>Plain text files require more disk space than binary files. This is
the price we have to pay for a readable file format. The default option
of <code>write_vc()</code> is to create file as compact as possible.
Since we use a tab delimited file format, we can omit quotes around
character variables. This saves 2 bytes per row for each character
variable. <code>write_vc</code> add quotes automatically in the
exceptional cases when we needed them, e.g. to store a string that
contains tab or newline characters. We don’t add quotes to row-variable
combinations where we don’t need them.</p>
<p>Since we store the class of each variable, we can further reduce the
file size by following rules:</p>
<ul>
<li>Store a <code>logical</code> as 0 (FALSE), 1 (TRUE) or NA to the
data.</li>
<li>Store a <code>factor</code> as its indices in the data. Store the
index, labels of levels and their order in the metadata.</li>
<li>Store a <code>POSIXct</code> as a numeric to the data. Store the
class and the origin in the metadata. Store and return timestamps as
UTC.</li>
<li>Store a <code>Date</code> as an integer to the data. Store the class
and the origin in the metadata.</li>
</ul>
<p>Storing the factors, POSIXct <!-- spell-check: ignore --> and Date as
their index, makes them less user readable. The user can turn off this
optimization when user readability is more important than file size.</p>
</div>
<div id="optimized-for-version-control" class="section level3">
<h3>Optimized for Version Control</h3>
<p>Another main goal of <code>git2rdata</code> is to optimise the
storage of the plain text files under version control.
<code>write_vc()</code> and <code>read_vc()</code> has methods for
interacting with <a href="https://git-scm.com/">git</a> repositories
using the <code>git2r</code> framework. Users who want to use git
without <code>git2r</code> or use a different version control system
(e.g. <a href="https://subversion.apache.org/">Subversion</a>, <a href="https://www.mercurial-scm.org/">Mercurial</a>), still can use
<code>git2rdata</code> to write the files to disk and uses their
preferred workflow on version control.</p>
<p>Hence, <code>write_vc()</code> will always perform checks to look for
changes which potentially lead to large diffs. More details on this in
<code>vignette(&quot;version_control&quot;, package = &quot;git2rdata&quot;)</code>. Some
problems will always yield a warning. Other problems will yield an error
by default. The user can turn these errors into warnings by setting the
<code>strict = FALSE</code> argument.</p>
<p>As this vignette ignores the part on version control, we will always
use <code>write_vc(strict = FALSE)</code> and hide the warnings to
improve the readability.</p>
</div>
</div>
<div id="basic-usage" class="section level2">
<h2>Basic Usage</h2>
<p>Let’s start by setting up the environment. We need a directory to
store the data and a dataframe to store.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Create a directory in tempdir</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">pattern =</span> <span class="st">&quot;git2r-&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">dir.create</span>(path)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Create dummy data</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20190222</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sample</span>(LETTERS),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">factor</span>(</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="cn">NA</span>), <span class="dv">26</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  ),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>),</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">abc =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">25</span>), <span class="cn">NA</span>),</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="at">def =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span>), <span class="dv">26</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="at">timestamp =</span> <span class="fu">seq</span>(</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="st">&quot;2018-01-01&quot;</span>),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="st">&quot;2019-01-01&quot;</span>),</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="at">length =</span> <span class="dv">26</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  ),</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="fu">str</span>(x)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    26 obs. of  6 variables:</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt;  $ x        : chr  &quot;V&quot; &quot;U&quot; &quot;Z&quot; &quot;W&quot; ...</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt;  $ y        : Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 2 NA NA 1 NA 2 1 NA 1 ...</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt;  $ z        : int  NA 1 2 3 4 5 6 7 8 9 ...</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt;  $ abc      : num  -0.382 -0.42 -0.917 0.387 -0.992 ...</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt;  $ def      : logi  TRUE FALSE NA FALSE NA NA ...</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt;  $ timestamp: POSIXct, format: &quot;2018-01-01 00:00:00&quot; &quot;2018-01-15 14:24:00&quot; ...</span></span></code></pre></div>
</div>
<div id="storing-optimized" class="section level2">
<h2>Storing Optimized</h2>
<p>Use <code>write_vc()</code> to store the dataframe. The
<code>root</code> argument refers to the base directory where we store
the data. The <code>file</code> argument becomes the base name of the
files. The data file gets a <code>.tsv</code> extension, the metadata
file a <code>.yml</code> extension. <code>file</code> can include a
relative path starting from <code>root</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(git2rdata)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">write_vc</span>(<span class="at">x =</span> x, <span class="at">file =</span> <span class="st">&quot;first_test&quot;</span>, <span class="at">root =</span> path, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; 3275ee74f2d2afe8d926aa7c9f2961670aaaefb8 79e04b2ecff2c1eac8ededc69ba09311f38f74da </span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;                         &quot;first_test.tsv&quot;                         &quot;first_test.yml&quot;</span></span></code></pre></div>
<p><code>write_vc()</code> returns a vector of relative paths to the raw
data and metadata files. The names of this vector contains the hashes of
these files. We can have a look at both files. We’ll display the first
10 rows of the raw data. Notice that the YAML format of the metadata has
the benefit of being both human and machine readable.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>print_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file, root, <span class="at">n =</span> <span class="sc">-</span><span class="dv">1</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(root, file)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">readLines</span>(fn, <span class="at">n =</span> n)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">cat</span>(data, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;first_test.tsv&quot;</span>, path, <span class="dv">10</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; V    1   NA  -0.38201    1   1514761200</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; U    2   1   -0.420348   0   1516022640</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; Z    NA  2   -0.916731   NA  1517284080</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; W    NA  3   0.387455    0   1518545520</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; L    1   4   -0.992355   NA  1519806960</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; C    NA  5   0.0228714   NA  1521068400</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; R    2   6   -0.947557   1   1522329840</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; S    1   7   -0.163029   NA  1523591280</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; O    NA  8   0.523643    1   1524852720</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;first_test.yml&quot;</span>, path)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt;   hash: 79e04b2ecff2c1eac8ededc69ba09311f38f74da</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt;   data_hash: 3275ee74f2d2afe8d926aa7c9f2961670aaaefb8</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; x:</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt;   class: character</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; &#39;y&#39;:</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt;   - a</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt;   - b</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt;   - c</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; z:</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt;   class: integer</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; abc:</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt;   class: numeric</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt;   digits: 6</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt; def:</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt;   class: logical</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt; timestamp:</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt;   class: POSIXct</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt;   origin: 1970-01-01 00:00:00</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt;   timezone: UTC</span></span></code></pre></div>
</div>
<div id="storing-verbose" class="section level2">
<h2>Storing Verbose</h2>
<p>Adding <code>optimize = FALSE</code> to <code>write_vc()</code> will
keep the raw data in a human readable format. The metadata file is
slightly different. The most obvious is the <code>optimize: no</code>
tag and the different hash. Another difference is the metadata for
POSIXct <!-- spell-check: ignore --> and Date classes. They will no
longer have an origin tag but a format tag.</p>
<p>Another important difference is that we store the data file as comma
separated values instead of tab separated values. We noticed that the
<code>csv</code> file format is more easily recognised by a larger
audience as a data file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">write_vc</span>(<span class="at">x =</span> x, <span class="at">file =</span> <span class="st">&quot;verbose&quot;</span>, <span class="at">root =</span> path, <span class="at">optimize =</span> <span class="cn">FALSE</span>, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; b2f5b98ccc92087a330148b53ef6f079d8095551 14cb4010f7f9f65eac46751c055904fc1e7d74e4 </span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt;                            &quot;verbose.csv&quot;                            &quot;verbose.yml&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;verbose.csv&quot;</span>, path, <span class="dv">10</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; x,y,z,abc,def,timestamp</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; V,a,NA,-0.38201,TRUE,2017-12-31T23:00:00Z</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; U,b,1,-0.420348,FALSE,2018-01-15T13:24:00Z</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; Z,NA,2,-0.916731,NA,2018-01-30T03:48:00Z</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; W,NA,3,0.387455,FALSE,2018-02-13T18:12:00Z</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; L,a,4,-0.992355,NA,2018-02-28T08:36:00Z</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; C,NA,5,0.0228714,NA,2018-03-14T23:00:00Z</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; R,b,6,-0.947557,TRUE,2018-03-29T13:24:00Z</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; S,a,7,-0.163029,NA,2018-04-13T03:48:00Z</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; O,NA,8,0.523643,TRUE,2018-04-27T18:12:00Z</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;verbose.yml&quot;</span>, path)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;   optimize: no</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;   hash: 14cb4010f7f9f65eac46751c055904fc1e7d74e4</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt;   data_hash: b2f5b98ccc92087a330148b53ef6f079d8095551</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; x:</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;   class: character</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; &#39;y&#39;:</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt;   - a</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt;   - b</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt;   - c</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; z:</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt;   class: integer</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; abc:</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co">#&gt;   class: numeric</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co">#&gt;   digits: 6</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="co">#&gt; def:</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="co">#&gt;   class: logical</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">#&gt; timestamp:</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="co">#&gt;   class: POSIXct</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a><span class="co">#&gt;   format: &#39;%Y-%m-%dT%H:%M:%SZ&#39;</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="co">#&gt;   timezone: UTC</span></span></code></pre></div>
</div>
<div id="efficiency-relative-to-file-storage" class="section level2">
<h2>Efficiency Relative to File Storage</h2>
<p>Storing dataframes optimized or verbose has an impact on the required
file size. The <a href="efficiency.html#on-a-file-system">efficiency</a>
vignette give a comparison.</p>
</div>
<div id="reading-data" class="section level2">
<h2>Reading Data</h2>
<p>You retrieve the data with <code>read_vc()</code>. This function will
reinstate the variables to their original state.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">read_vc</span>(<span class="at">file =</span> <span class="st">&quot;first_test&quot;</span>, <span class="at">root =</span> path)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">all.equal</span>(x, y, <span class="at">check.attributes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Component \&quot;abc\&quot;: Mean relative difference: 5.679135e-07&quot;                  </span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; [2] &quot;Component \&quot;timestamp\&quot;: &#39;tzone&#39; attributes are inconsistent (&#39;&#39; and &#39;UTC&#39;)&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">read_vc</span>(<span class="at">file =</span> <span class="st">&quot;verbose&quot;</span>, <span class="at">root =</span> path)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">all.equal</span>(x, y2, <span class="at">check.attributes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Component \&quot;abc\&quot;: Mean relative difference: 5.679135e-07&quot;                  </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; [2] &quot;Component \&quot;timestamp\&quot;: &#39;tzone&#39; attributes are inconsistent (&#39;&#39; and &#39;UTC&#39;)&quot;</span></span></code></pre></div>
<p><code>read_vc()</code> requires the meta data. It cannot handle
dataframe not stored by <code>write_vc()</code>.</p>
</div>
<div id="missing-values" class="section level2">
<h2>Missing Values</h2>
<p><code>write_vc()</code> has an <code>na</code> argument which
specifies the string which to use for missing values. Because we avoid
using quotes, this string must be different from any character value in
the data. This includes factor labels with verbose data storage.
<code>write_vc()</code> checks this and will always return an error,
even with <code>strict = FALSE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;custom_na&quot;</span>, path, <span class="at">strict =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">&quot;X&quot;</span>, <span class="at">optimize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Error: one of the strings matches the NA string (&#39;X&#39;)</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Please use a different NA string or consider using a factor.</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;custom_na&quot;</span>, path, <span class="at">strict =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">&quot;b&quot;</span>, <span class="at">optimize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Error: one of the levels matches the NA string (&#39;b&#39;).</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; Please use a different NA string or use optimize = TRUE</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;custom_na&quot;</span>, path, <span class="at">strict =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">&quot;X&quot;</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; Error: one of the strings matches the NA string (&#39;X&#39;)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; Please use a different NA string or consider using a factor.</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;custom_na&quot;</span>, path, <span class="at">strict =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; ebfaf6b0aee9ae1252e176c173b20cdcf009d9b0 42235e10f9b5734d8718d02799d3ca6760c6a640 </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;                          &quot;custom_na.tsv&quot;                          &quot;custom_na.yml&quot;</span></span></code></pre></div>
<p>Please note that <code>write_vc()</code> uses the same NA string for
the entire dataset, thus for every variable.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;custom_na.tsv&quot;</span>, path, <span class="dv">10</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; V    1   b   -0.38201    1   1514761200</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; U    2   1   -0.420348   0   1516022640</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; Z    b   2   -0.916731   b   1517284080</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; W    b   3   0.387455    0   1518545520</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; L    1   4   -0.992355   b   1519806960</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; C    b   5   0.0228714   b   1521068400</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; R    2   6   -0.947557   1   1522329840</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; S    1   7   -0.163029   b   1523591280</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; O    b   8   0.523643    1   1524852720</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;custom_na.yml&quot;</span>, path, <span class="dv">4</span>)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;   NA string: b</span></span></code></pre></div>
<p>The default string for missing values is <code>&quot;NA&quot;</code>. We
recommend to keep this default, as long as the dataset permits it. A
first good alternative is an empty string (<code>&quot;&quot;</code>). If that
won’t work either, you’ll have to use your imagination. Try to keep it
short, clear and robust<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;custom_na&quot;</span>, path, <span class="at">strict =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; ffac752af23cf1db429ec48fa2ebf72db1f35dc1 e58a31060d6f1e2f42e3541bf26276fa1f8102f4 </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;                          &quot;custom_na.tsv&quot;                          &quot;custom_na.yml&quot;</span></span></code></pre></div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>robust in the sense that you won’t need to change it
later<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
