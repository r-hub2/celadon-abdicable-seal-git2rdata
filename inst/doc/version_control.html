<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Thierry Onkelinx" />


<title>Optimizing Storage for Version Control</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Optimizing Storage for Version Control</h1>
<h4 class="author">Thierry Onkelinx</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette focuses on what <code>git2rdata</code> does to make
storing dataframes under version control more efficient and convenient.
<code>vignette(&quot;plain_text&quot;, package = &quot;git2rdata&quot;)</code> describes all
details on the actual file format. Hence we will not discuss the
<code>optimize</code> and <code>na</code> arguments to the
<code>write_vc()</code> function.</p>
<p>We will not illustrate the efficiency of <code>write_vc()</code> and
<code>read_vc()</code>.
<code>vignette(&quot;efficiency&quot;, package = &quot;git2rdata&quot;)</code> covers those
topics.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Create a directory in tempdir</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">pattern =</span> <span class="st">&quot;git2r-&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">dir.create</span>(root)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Create dummy data</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20190222</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sample</span>(LETTERS),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">factor</span>(</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="cn">NA</span>), <span class="dv">26</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  ),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>),</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">abc =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">25</span>), <span class="cn">NA</span>),</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="at">def =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span>), <span class="dv">26</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="at">timestamp =</span> <span class="fu">seq</span>(</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="st">&quot;2018-01-01&quot;</span>),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    <span class="fu">as.POSIXct</span>(<span class="st">&quot;2019-01-01&quot;</span>),</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="at">length =</span> <span class="dv">26</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  ),</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="fu">str</span>(x)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    26 obs. of  6 variables:</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt;  $ x        : chr  &quot;V&quot; &quot;U&quot; &quot;Z&quot; &quot;W&quot; ...</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt;  $ y        : Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 2 NA NA 1 NA 2 1 NA 1 ...</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt;  $ z        : int  NA 1 2 3 4 5 6 7 8 9 ...</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt;  $ abc      : num  -0.382 -0.42 -0.917 0.387 -0.992 ...</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt;  $ def      : logi  TRUE FALSE NA FALSE NA NA ...</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt;  $ timestamp: POSIXct, format: &quot;2018-01-01 00:00:00&quot; &quot;2018-01-15 14:24:00&quot; ...</span></span></code></pre></div>
</div>
<div id="assumptions" class="section level2">
<h2>Assumptions</h2>
<p>A critical assumption made by <code>git2rdata</code> is that the
dataframe itself contains all information. Each row is an observation,
each column is a variable. The dataframe has <code>colnames</code> but
no <code>rownames</code>. This implies that two observations switching
place does not alter the information content. Nor does switching two
variables.</p>
<p>Version control systems like <a href="https://git-scm.com/">git</a>,
<a href="https://subversion.apache.org/">subversion</a> or <a href="https://www.mercurial-scm.org/">mercurial</a> focus on accurately
keeping track of <em>any</em> change in the files. Two observations
switching place in a plain text file <em>is</em> a change, although the
information content<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> doesn’t change. <code>git2rdata</code>
helps the user to prepare the plain text files in such a way that any
change in the version history is an actual change in the information
content.</p>
</div>
<div id="sorting-observations" class="section level2">
<h2>Sorting Observations</h2>
<p>Version control systems often track changes in plain text files based
on row based differences. In layman’s terms they record lines removed
from and inserted in the file at what location. Changing an existing
line implies removing the old version and inserting the new one. The
minimal example below illustrates this.</p>
<p>Original version</p>
<pre><code>A,B
1,10
2,11
3,12</code></pre>
<p>Altered version. The row containing <code>1, 10</code> moves to the
last line. The row containing <code>3,12</code> changed to
<code>3,0</code>.</p>
<pre><code>A,B
2,11
3,0
1,10</code></pre>
<p>Diff between original and altered version. Notice than we have a
deletion of two lines and two insertions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>A,B</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="st">-1,10</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="dt">2,11</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="st">-3,12</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="va">+3,0</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="va">+1,10</span></span></code></pre></div>
<p>Ensuring that the observations are always sorted in the same way thus
helps minimizing the diff. The sorted version of the same altered
version looks like the example below.</p>
<pre><code>A,B
1,10
2,11
3,0</code></pre>
<p>Diff between original and the sorted alternate version. Notice that
all changes revert to actual changes in the information content. Another
benefit is that changes are easily spotted in the diff. A deletion
without insertion on the next line is a removed observation. An
insertion without preceding deletion is a new observation. A deletion
followed by an insertion is an updated observation.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>A,B</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="dt">1,10</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="dt">2,11</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="st">-3,12</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="va">+3,0</span></span></code></pre></div>
<p>This is where the <code>sorting</code> argument comes into play. If
this argument is not provided when writing a file for the first time, it
will yield a warning about the lack of sorting. <code>write_vc()</code>
then writes the observations in their current order. New versions of the
file will not apply any sorting either, leaving this burden to the user.
The changed hash for the data file illustrates this in the example
below. The metadata hash remains the same.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(git2rdata)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="at">file =</span> <span class="st">&quot;row_order&quot;</span>, <span class="at">root =</span> root)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Warning in meta.data.frame(x, optimize = optimize, na = na, sorting = sorting, :</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; `digits` was not set. Setting is automatically to 6. See ?meta</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Warning: No sorting applied.</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; Sorting is strongly recommended in combination with version control.</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 3275ee74f2d2afe8d926aa7c9f2961670aaaefb8 79e04b2ecff2c1eac8ededc69ba09311f38f74da </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt;                          &quot;row_order.tsv&quot;                          &quot;row_order.yml&quot;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">write_vc</span>(x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x)), ], <span class="at">file =</span> <span class="st">&quot;row_order&quot;</span>, <span class="at">root =</span> root)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; Warning: No sorting applied.</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; Sorting is strongly recommended in combination with version control.</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; aab5bcb1241df83dbe495a0d2f38cfb65706c7bb 79e04b2ecff2c1eac8ededc69ba09311f38f74da </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;                          &quot;row_order.tsv&quot;                          &quot;row_order.yml&quot;</span></span></code></pre></div>
<p><code>sorting</code> should contain a vector of variable names. The
observations are automatically sorted along these variables. Now we get
an error because the set of sorting variables has changed. The metadata
stores the set of sorting variables. Changing the sorting can
potentially lead to large diffs, which <code>git2rdata</code> tries to
avoid as much as possible.</p>
<p>From this moment on we will store the output of
<code>write_vc()</code> in an object reduce output.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x, <span class="st">&quot;row_order&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; Warning: Sorting on &#39;y&#39; results in ties.</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; Error: The data was not overwritten because of the issues below.</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; - The sorting variables changed.</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the new data: &#39;y&#39;.</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the old data: .</span></span></code></pre></div>
<p>Using <code>strict = FALSE</code> turns such errors into warnings and
allows to update the file. Notice that we get a new warning: the
variable we used for sorting resulted in ties, thus the order of the
observations is not guaranteed to be stable. The solution is to use more
or different variables. We’ll need <code>strict = FALSE</code> again to
override the change in sorting variables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x, <span class="st">&quot;row_order&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;y&quot;</span>, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; Warning: Sorting on &#39;y&#39; results in ties.</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; - The sorting variables changed.</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the new data: &#39;y&#39;.</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the old data: .</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x, <span class="st">&quot;row_order&quot;</span>, root, <span class="at">sorting =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;x&quot;</span>), <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; - The sorting variables changed.</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the new data: &#39;y&#39;, &#39;x&#39;.</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;     - Sorting for the old data: &#39;y&#39;.</span></span></code></pre></div>
<p>Once we have defined the sorting, we may omit the
<code>sorting</code> argument when writing new versions.
<code>write_vc</code> uses the sorting as defined in the existing
metadata. It checks for potential ties. Ties results in a warning.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>print_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file, root, <span class="at">n =</span> <span class="sc">-</span><span class="dv">1</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(root, file)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">readLines</span>(fn, <span class="at">n =</span> n)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">cat</span>(data, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>}</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;row_order.yml&quot;</span>, root, <span class="dv">7</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;   sorting:</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;   - &#39;y&#39;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;   - x</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x)), ], <span class="st">&quot;row_order&quot;</span>, root)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x)), ], <span class="st">&quot;row_order&quot;</span>, root, <span class="at">sorting =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;x&quot;</span>))</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x), <span class="at">replace =</span> <span class="cn">TRUE</span>), ], <span class="st">&quot;row_order&quot;</span>, root)</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; Warning: Sorting on &#39;y&#39;, &#39;x&#39; results in ties.</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span></code></pre></div>
</div>
<div id="sorting-variables" class="section level2">
<h2>Sorting Variables</h2>
<p>The order of the variables (columns) has an even bigger impact on a
row based diff. Let’s revisit our minimal example. Suppose that we swap
<code>A</code> and <code>B</code> from our <a href="#sorting-observations">original example</a>. The new data looks as
below.</p>
<pre><code>B,A
10,1
11,2
13,3</code></pre>
<p>The resulting diff is maximal because every single row changed. Yet
none of the information changed. Hence, maintaining column order is
crucial when storing dataframes as plain text files under version
control. The <code>vignette(&quot;efficiency&quot;, package = &quot;git2rdata&quot;)</code>
vignette illustrates this on a more realistic data set.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="st">-A,B</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="va">+B,A</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="st">-1,10</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="va">+10,1</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="st">-2,11</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="va">+11,2</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="st">-3,13</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="va">+13,3</span></span></code></pre></div>
<p>When <code>write_vc()</code> writes a dataframe for the first time,
it stores the original order of the columns in the metadata. From that
moment on, <code>write_vc()</code> uses the order stored in the
metadata. The example below writes the same data set twice. The second
version contains identical information but randomizes the order of the
observations and the columns. The sorting by the internals of
<code>write_vc()</code> will undo this randomization, resulting in an
unchanged file.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">write_vc</span>(x, <span class="st">&quot;column_order&quot;</span>, root, <span class="at">sorting =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;abc&quot;</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; Warning in meta.data.frame(x, optimize = optimize, na = na, sorting = sorting, :</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; `digits` was not set. Setting is automatically to 6. See ?meta</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; 1268416fc214c518352c0faa4a982fdffc6a8847 0d8985d9b4bb134b5381581f854c51447f8c9300 </span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;                       &quot;column_order.tsv&quot;                       &quot;column_order.yml&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;column_order.tsv&quot;</span>, root, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; A    1   18  0.572193    0   1537467120</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; B    2   14  -1.64221    0   1532421360</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; C    NA  5   0.0228714   NA  1521068400</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; D    2   20  -0.683184   NA  1539990000</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="fu">write_vc</span>(x[<span class="fu">sample</span>(<span class="fu">nrow</span>(x)), <span class="fu">sample</span>(<span class="fu">ncol</span>(x))], <span class="st">&quot;column_order&quot;</span>, root)</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; 1268416fc214c518352c0faa4a982fdffc6a8847 0d8985d9b4bb134b5381581f854c51447f8c9300 </span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt;                       &quot;column_order.tsv&quot;                       &quot;column_order.yml&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;column_order.tsv&quot;</span>, root, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; A    1   18  0.572193    0   1537467120</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; B    2   14  -1.64221    0   1532421360</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; C    NA  5   0.0228714   NA  1521068400</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt; D    2   20  -0.683184   NA  1539990000</span></span></code></pre></div>
</div>
<div id="handling-factors-optimized" class="section level2">
<h2>Handling Factors Optimized</h2>
<p><code>vignette(&quot;plain_text&quot;, package = &quot;git2rdata&quot;)</code> and
<code>vignette(&quot;efficiency&quot;, package = &quot;git2rdata&quot;)</code> illustrate
how we can store a factor more efficiently when storing their index in
the data file and the indices and labels in the metadata. We take this
even a bit further: what happens if new data arrives and we need an
extra factor level?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>old <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">write_vc</span>(old, <span class="st">&quot;factor&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;                             &quot;factor.tsv&quot;                             &quot;factor.yml&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;factor.yml&quot;</span>, root)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt;   hash: 03c3898451e17cf436da59dd0e712606ea63a838</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt;   - blue</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>Let’s add an observation with a new factor level. If we store the
updated dataframe in a new file, we see that the indices are different.
The factor level <code>&quot;blue&quot;</code> remains unchanged, but
<code>&quot;red&quot;</code> becomes the third level and get index <code>3</code>
instead of index <code>2</code>. This could lead to a large diff whereas
the potential semantics (and thus the information content) are not
changed.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>updated <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">write_vc</span>(updated, <span class="st">&quot;factor2&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 74f0f3c72a5041344924bed321efedf45f5c5250 f2cc274714fef0b55e17ae432e99b73e5c880e2d </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt;                            &quot;factor2.tsv&quot;                            &quot;factor2.yml&quot;</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;factor2.yml&quot;</span>, root)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt;   hash: f2cc274714fef0b55e17ae432e99b73e5c880e2d</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;   data_hash: 74f0f3c72a5041344924bed321efedf45f5c5250</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt;   - blue</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt;   - green</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>When we try to overwrite the original data with the updated version,
we get an error because there is a change in factor levels and / or
indices. In this specific case, we decided that the change is OK and
force the writing by setting <code>strict = FALSE</code>. Notice that
the original labels (<code>&quot;blue&quot;</code> and <code>&quot;red&quot;</code>) keep
their index, the new level (<code>&quot;green&quot;</code>) gets the first
available index number.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">write_vc</span>(updated, <span class="st">&quot;factor&quot;</span>, root)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; Error: The data was not overwritten because of the issues below.</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; - New factor labels for &#39;color&#39;.</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; - New indices for &#39;color&#39;.</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">write_vc</span>(updated, <span class="st">&quot;factor&quot;</span>, root, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; - New factor labels for &#39;color&#39;.</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; - New indices for &#39;color&#39;.</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;factor.yml&quot;</span>, root)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt;   hash: e0ed4c773b2179346042fef6f8c22c42c22a7c00</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="co">#&gt;   data_hash: bf0c9f17b88b2e8768abc914349bb32e86503654</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="co">#&gt;   - blue</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co">#&gt;   - green</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>The next example removes the <code>&quot;blue&quot;</code> level and switches
the order of the remaining levels. Notice that the meta data retains the
existing indices. The order of the labels and indices reflects their new
ordering.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>deleted <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>))</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">write_vc</span>(deleted, <span class="st">&quot;factor&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; - New factor labels for &#39;color&#39;.</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; - New indices for &#39;color&#39;.</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; 1d15f9b5c154535e2e7d2d5cb5619af7da41a066 3cadfe4021fe5e2990d0bb057100c608e3b602fa </span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt;                             &quot;factor.tsv&quot;                             &quot;factor.yml&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;factor.yml&quot;</span>, root)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt;   hash: 3cadfe4021fe5e2990d0bb057100c608e3b602fa</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt;   data_hash: 1d15f9b5c154535e2e7d2d5cb5619af7da41a066</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">#&gt;   - green</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>Changing a factor to an ordered factor or <em>vice versa</em> will
also keep existing level indices.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>ordered <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">write_vc</span>(ordered, <span class="st">&quot;factor&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; - &#39;color&#39; changes from nominal to ordinal.</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; 1d15f9b5c154535e2e7d2d5cb5619af7da41a066 57ff604596058d60e97fbb9c93ee6869f32c1850 </span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt;                             &quot;factor.tsv&quot;                             &quot;factor.yml&quot;</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;factor.yml&quot;</span>, root)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt;   hash: 57ff604596058d60e97fbb9c93ee6869f32c1850</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt;   data_hash: 1d15f9b5c154535e2e7d2d5cb5619af7da41a066</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt;   - green</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a><span class="co">#&gt;   ordered: yes</span></span></code></pre></div>
</div>
<div id="relabelling-a-factor" class="section level2">
<h2>Relabelling a Factor</h2>
<p>The example below will store a dataframe, relabel the factor levels
and store it again using <code>write_vc()</code>. Notice the update of
both the labels and the indices. Hence creating a large diff, where
updating the labels would do.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">write_vc</span>(old, <span class="st">&quot;write_vc&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt;                           &quot;write_vc.tsv&quot;                           &quot;write_vc.yml&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;write_vc.yml&quot;</span>, root)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt;   hash: 03c3898451e17cf436da59dd0e712606ea63a838</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt;   - blue</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt;   - red</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>relabeled <span class="ot">&lt;-</span> old</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co"># translate the color names to Dutch</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="fu">levels</span>(relabeled<span class="sc">$</span>color) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;blauw&quot;</span>, <span class="st">&quot;rood&quot;</span>)</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="fu">write_vc</span>(relabeled, <span class="st">&quot;write_vc&quot;</span>, root, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;version_control&#39;, package = &#39;git2rdata&#39;) for more information.</span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="co">#&gt; - New factor labels for &#39;color&#39;.</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#&gt; - New indices for &#39;color&#39;.</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co">#&gt; bcf85634c3b33377842b37e4d21c3546f7572055 f6730454185caeb173c6883ce56200c376975567 </span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co">#&gt;                           &quot;write_vc.tsv&quot;                           &quot;write_vc.yml&quot;</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;write_vc.yml&quot;</span>, root)</span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="co">#&gt;   hash: f6730454185caeb173c6883ce56200c376975567</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="co">#&gt;   data_hash: bcf85634c3b33377842b37e4d21c3546f7572055</span></span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a><span class="co">#&gt;   - blauw</span></span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a><span class="co">#&gt;   - rood</span></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a><span class="co">#&gt;   - 3</span></span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a><span class="co">#&gt;   - 4</span></span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>We created <code>relabel()</code>, which changes the labels in the
meta data while maintaining their indices. It takes three arguments: the
name of the data file, the root and the change. <code>change</code>
accepts two formats, a list or a dataframe. The name of the list must
match with the variable name of a factor in the data. Each element of
the list must be a named vector, the name being the existing label and
the value the new label. The dataframe format requires a
<code>factor</code>, <code>old</code> and <code>new</code> variable with
one row for each change in label.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">write_vc</span>(old, <span class="st">&quot;relabel&quot;</span>, root, <span class="at">sorting =</span> <span class="st">&quot;color&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;                            &quot;relabel.tsv&quot;                            &quot;relabel.yml&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="fu">relabel</span>(<span class="st">&quot;relabel&quot;</span>, root, <span class="at">change =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="at">red =</span> <span class="st">&quot;rood&quot;</span>, <span class="at">blue =</span> <span class="st">&quot;blauw&quot;</span>)))</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;relabel.yml&quot;</span>, root)</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt;   hash: bb25c6cc455f6d8e52b7daeb176adf83d8c5b0f9</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt;   - blauw</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt;   - rood</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="fu">relabel</span>(</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  <span class="st">&quot;relabel&quot;</span>, root,</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>  <span class="at">change =</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>    <span class="at">factor =</span> <span class="st">&quot;color&quot;</span>, <span class="at">old =</span> <span class="st">&quot;blauw&quot;</span>, <span class="at">new =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>  )</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="fu">print_file</span>(<span class="st">&quot;relabel.yml&quot;</span>, root)</span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a><span class="co">#&gt; ..generic:</span></span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a><span class="co">#&gt;   git2rdata: 0.5.1</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a><span class="co">#&gt;   optimize: yes</span></span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a><span class="co">#&gt;   NA string: NA</span></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a><span class="co">#&gt;   sorting: color</span></span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a><span class="co">#&gt;   hash: a4050f89a749abce203ae6e1fe6b41483d385c2d</span></span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a><span class="co">#&gt; color:</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a><span class="co">#&gt;   class: factor</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a><span class="co">#&gt;   labels:</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a><span class="co">#&gt;   - blue</span></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a><span class="co">#&gt;   - rood</span></span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="co">#&gt;   index:</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a><span class="co">#&gt;   - 1</span></span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a><span class="co">#&gt;   - 2</span></span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>A <em>caveat</em>: <code>relabel()</code> does not make sense when
the data file uses verbose storage. The verbose mode stores the factor
labels and not their indices, in which case relabelling a label will
always yield a large diff. Hence, <code>relabel()</code> requires the
optimized storage.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p> <em>sensu</em> <!-- spell-check: ignore -->
<code>git2rdata</code><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
